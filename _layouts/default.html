<!DOCTYPE html>
<html lang="{{ page.lang | default: 'en' }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% if page.title %}{{ page.title }} - {% endif %}{{ site.title }}</title>
  <meta name="description" content="{{ page.description | default: site.description }}">
  <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
  <link rel="icon" href="{{ '/favicon.ico' | relative_url }}" type="image/x-icon">
  {% if page.lang == 'zh' %}
  <link rel="alternate" hreflang="zh" href="{{ site.url }}{{ page.url }}" />
  <link rel="alternate" hreflang="en" href="{{ site.url }}{{ page.url | remove: '/zh' }}" />
  <link rel="alternate" hreflang="x-default" href="{{ site.url }}{{ page.url | remove: '/zh' }}" />
  {% else %}
  <link rel="alternate" hreflang="en" href="{{ site.url }}{{ page.url }}" />
  <link rel="alternate" hreflang="zh" href="{{ site.url }}/zh{{ page.url }}" />
  <link rel="alternate" hreflang="x-default" href="{{ site.url }}{{ page.url }}" />
  {% endif %}
</head>
<body>
  <header>
    <nav>
      <a href="{% if page.lang == 'zh' %}/zh/{% else %}/{% endif %}" class="logo">
        <img src="{{ '/assets/images/icon.png' | relative_url }}" alt="Dash for Outline" width="32" height="32">
        <span>Dash for Outline</span>
      </a>
      <div class="nav-links">
        {% if page.lang == 'zh' %}
        <a href="/zh/#features" class="nav-anchor">介绍</a>
        <a href="/zh/#comparison" class="nav-anchor">对比</a>
        <a href="/zh/support">帮助</a>
        <a href="/" class="lang-switch">EN</a>
        {% else %}
        <a href="/#features" class="nav-anchor">Features</a>
        <a href="/#comparison" class="nav-anchor">Compare</a>
        <a href="/support">Support</a>
        <a href="/zh/" class="lang-switch">中文</a>
        {% endif %}
      </div>
    </nav>
  </header>

  <main>
    {% if page.toc %}
    <div class="doc-layout">
      <div class="doc-content">
        {{ content }}
      </div>
      <aside class="doc-toc">
        <div class="toc-inner">
          <p class="toc-label">{% if page.lang == 'zh' %}本页目录{% else %}On This Page{% endif %}</p>
          <nav id="toc-nav"></nav>
        </div>
      </aside>
    </div>
    {% else %}
    {{ content }}
    {% endif %}
  </main>

  <footer>
    <div class="footer-content">
      {% if page.lang == 'zh' %}
      <nav class="footer-nav">
        <a href="/zh/privacy">隐私政策</a>
        <a href="/zh/terms">使用条款</a>
        <a href="/zh/support">常见问题</a>
        <a class="email-link" data-user="sam" data-domain="getdashvpn.com">联系我们</a>
      </nav>
      <p class="copyright">© 2026 Dash Network Software Co., Ltd. All rights reserved.</p>
      {% else %}
      <nav class="footer-nav">
        <a href="/privacy">Privacy</a>
        <a href="/terms">Terms</a>
        <a href="/support">FAQ</a>
        <a class="email-link" data-user="sam" data-domain="getdashvpn.com">Support</a>
      </nav>
      <p class="copyright">© 2026 Dash Network Software Co., Ltd. All rights reserved.</p>
      {% endif %}
    </div>
  </footer>
<script>
document.querySelectorAll('.email-link').forEach(function(el) {
  var u = el.dataset.user, d = el.dataset.domain;
  el.href = 'mailto:' + u + '@' + d;
});

(function() {
  var path = window.location.pathname;
  if (path.startsWith('/zh') || localStorage.getItem('lang_override')) return;
  var lang = navigator.language || navigator.userLanguage;
  if (lang && lang.startsWith('zh')) {
    var zhPath = '/zh' + (path === '/' ? '/' : path);
    window.location.replace(zhPath);
  }
})();

document.querySelectorAll('.lang-switch').forEach(function(el) {
  el.addEventListener('click', function() {
    localStorage.setItem('lang_override', 'true');
  });
});

(function() {
  var nav = document.getElementById('toc-nav');
  if (!nav) return;
  var content = document.querySelector('.doc-content');
  if (!content) return;
  var headings = content.querySelectorAll('h2, h3');
  if (!headings.length) return;

  var ul = document.createElement('ul');
  headings.forEach(function(h) {
    var li = document.createElement('li');
    li.className = h.tagName.toLowerCase();
    var a = document.createElement('a');
    a.href = '#' + h.id;
    a.textContent = h.textContent.replace(/\p{Emoji_Presentation}/gu, '').trim();
    li.appendChild(a);
    ul.appendChild(li);
  });
  nav.appendChild(ul);

  var links = nav.querySelectorAll('a');
  function setActive() {
    var scrollY = window.scrollY + 100;
    var current = '';
    headings.forEach(function(h) {
      if (h.offsetTop <= scrollY) current = h.id;
    });
    links.forEach(function(a) {
      a.classList.toggle('toc-active', a.getAttribute('href') === '#' + current);
    });
  }
  window.addEventListener('scroll', setActive, { passive: true });
  setActive();
})();
</script>
</body>
</html>
